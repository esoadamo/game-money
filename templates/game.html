{% extends 'base.html' %}
{% block head %}
    <link rel="stylesheet" href="/static/styles/game.css">
{% endblock %}
{% block content %}
    <div class="container">
        <div class="col-xs-12"><h1 id="gameName" r-var="v.gameName"></h1></div>
        <div class="col-xs-12">
            <ul class="nav nav-tabs">
                <li class="clickable" r-for="player of v.players">
                    <a data-toggle="tab"
                       r-attr="{&quot;href&quot;: &quot;'#tabBlayer' + l.player.id&quot;}"
                       r-var="l.player.name"
                    ></a>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane"
                     r-for="player of v.players"
                     r-attr="{&quot;id&quot;: &quot;'tabBlayer' + l.player.id&quot;}">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-6">
                                <h3 class="clickable" r-var="l.player.name" r-click="f.changePlayerName(l.player.id)">
                                </h3>
                            </div>
                            <div class="col-md-6">
                                <button class="btn"><i class="fa fa-share"></i> Send money</button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th>Amount</th>
                                            <th>Currency</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr r-for="m of l.player.money">
                                            <td r-if="!l.player.infinite" r-var="l.m.amount"></td>
                                            <td r-if="l.player.infinite">âˆž</td>
                                            <td r-var="l.m.currency"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-6">PLACEHOLDER</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script>
        loginComplete = (comm, renderer) => {
            let gameId = null;

            renderer.functions.changePlayerName = (playerID) => {
                askText("Enter new name:").then((name) =>
                    comm.send("playerNameChange", {game: gameId, player: playerID, name})
                );
            };

            function onMessage(type, msg) {
                switch (type) {
                    case 'gameInfo':
                        renderer.variables.gameName = msg.name;
                        gameId = msg.id;
                        renderer.render($('#gameName').elem);
                        break;
                    case 'players':
                        renderer.variables.players = msg;
                        renderer.render();
                        break;
                }
            }

            comm.onMessage = onMessage;
            comm.send('gameInfo', location.pathname);
        };
    </script>
{% endblock %}